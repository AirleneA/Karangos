{"ast":null,"code":"import _regeneratorRuntime from\"/workspace/Karangos/karangos/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/workspace/Karangos/karangos/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/workspace/Karangos/karangos/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/workspace/Karangos/karangos/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import TextField from'@material-ui/core/TextField';import MenuItem from'@material-ui/core/MenuItem';import FormControl from'@material-ui/core/FormControl';import FormControlLabel from'@material-ui/core/FormControlLabel';import Checkbox from'@material-ui/core/Checkbox';import InputMask from'react-input-mask';import{makeStyles}from'@material-ui/core/styles';import InputAdornment from'@material-ui/core/InputAdornment';import Toolbar from'@material-ui/core/Toolbar';import Button from'@material-ui/core/Button';import axios from'axios';import{useHistory,useParams}from'react-router-dom';import Snackbar from'@material-ui/core/Snackbar';import MuiAlert from'@material-ui/lab/Alert';import React from'react';import ConfirmDialog from'../ui/ConfirmDialog';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{form:{display:'flex',justifyContent:'space-around',flexWrap:'wrap',maxWidth:'80%',margin:'0 auto','& .MuiFormControl-root':{minWidth:'200px',maxWidth:'500px',margin:'0 24px 24px 0'}},toolbar:{display:'flex',width:'100%',justifyContent:'space-around',marginTop:'36px'}};});export default function KarangosForm(){var classes=useStyles();var colors=['Amarelo','Azul','Bege','Branco','Cinza','Dourado','Laranja','Marrom','Prata','Preto','Rosa','Roxo','Verde','Vermelho','Vinho'];var years=[];for(var i=new Date().getFullYear();i>=1900;i--){years.push(i);}// Classes de caracters para a máscara da placa\n// 1) Três primeiras posições, somente letras (maiúsculas ou minúsculas) ~> [A-Za-z]\n// 2) Quinta, sétima e oitava posições, somente dígitos ~> [0-9]\n// 3) Sexta posição: dígitos ou letras (maiúsculas ou minúsculas) de A a J ~> [0-9A-Ja-j]\nvar formatChars={'A':'[A-Za-z]','0':'[0-9]','#':'[0-9A-Ja-j]'};// Máscara de entrada para a placa\nvar placaMask='AAA-0#00';// Máscara para CPF: '000.000.000-00'\n// Máscara para CNPJ: '00.000.000/0000-00'\nvar _useState=useState({id:null,marca:'',modelo:'',cor:'',ano_fabricacao:new Date().getFullYear(),// Ano corrente\nimportado:'0',placa:'',preco:0}),_useState2=_slicedToArray(_useState,2),karango=_useState2[0],setKarango=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),currentId=_useState4[0],setCurrentId=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),importadoChecked=_useState6[0],setImportadoChecked=_useState6[1];var _useState7=useState({disabled:false,label:'Enviar'}),_useState8=_slicedToArray(_useState7,2),sendBtnStatus=_useState8[0],setSendBtnStatus=_useState8[1];var _useState9=useState({open:false,severity:'success',message:''}),_useState10=_slicedToArray(_useState9,2),sbStatus=_useState10[0],setSbStatus=_useState10[1];var _useState11=useState({marca:'',modelo:'',cor:'',placa:'',preco:''}),_useState12=_slicedToArray(_useState11,2),error=_useState12[0],setError=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isModified=_useState14[0],setIsModified=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),dialogOpen=_useState16[0],setDialogOpen=_useState16[1];// O diálogo de confirmação está aberto?\nvar _useState17=useState('Cadastrar novo karango'),_useState18=_slicedToArray(_useState17,2),title=_useState18[0],setTitle=_useState18[1];var history=useHistory();var params=useParams();// useEffect() para quando o formulário for carregado (só na inicialização)\nuseEffect(function(){// Verificamos se a rota atual contém o parâmetro id\n// Em caso positivo, buscamos os dados no back-end e carregamos o formulário para edição\nif(params.id){setTitle('Editar karango');getData(params.id);}},[]);function getData(_x){return _getData.apply(this,arguments);}function _getData(){_getData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get(\"https://api.faustocintra.com.br/karangos/\".concat(id));case 3:response=_context.sent;setKarango(response.data);_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);setSbStatus({open:true,severity:'error',message:'Não foi possível carregar os dados para edição.'});case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return _getData.apply(this,arguments);}function handleInputChange(event,property){var karangoTemp=_objectSpread({},karango);setCurrentId(event.target.id);if(event.target.id)property=event.target.id;if(property==='importado'){var newState=!importadoChecked;// Inverte o valor\nif(newState)karangoTemp.importado='1';else karangoTemp.importado='0';setImportadoChecked(newState);}else if(property==='placa'){karangoTemp.placa=event.target.value.toUpperCase();}else{// Quando o nome de uma propriedade de objeto aparece entre [],\n// significa que o nome da propriedade será determinado pela\n// variável ou expressão contida dentro dos colchetes\nkarangoTemp[property]=event.target.value;}setKarango(karangoTemp);setIsModified(true);// O formulário foi modificado\nvalidate(karangoTemp);// Dispara a validação\n}function validate(data){var isValid=true;var errorTemp={marca:'',modelo:'',cor:'',placa:'',preco:''};// trim(): retira espaços em branco do início e do final de uma string\nif(data.marca.trim()===''){errorTemp.marca='A marca deve ser preenchida';isValid=false;}if(data.modelo.trim()===''){errorTemp.modelo='O modelo deve ser preenchido';isValid=false;}if(data.cor.trim()===''){errorTemp.cor='A cor deve ser informada';isValid=false;}// A placa não pode ser string vazia nem conter sublinhado\nif(data.placa.trim()===''||data.placa.includes('_')){errorTemp.placa='A placa deve ser preenchida corretamente';isValid=false;}// O preço deve ser numérico e maior que zero\nif(isNaN(data.preco)||Number(data.preco)<=0){errorTemp.preco='O preço deve ser informado e maior que zero';isValid=false;}setError(errorTemp);return isValid;}function saveData(){return _saveData.apply(this,arguments);}function _saveData(){_saveData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;// Desabilita o botão de enviar para evitar envios duplicados\nsetSendBtnStatus({disabled:true,label:'Enviando...'});// Se estivermos editando, precisamos enviar os dados com o verbo HTTP PUT\nif(!params.id){_context2.next=7;break;}_context2.next=5;return axios.put(\"https://api.faustocintra.com.br/karangos/\".concat(params.id),karango);case 5:_context2.next=9;break;case 7:_context2.next=9;return axios.post('https://api.faustocintra.com.br/karangos',karango);case 9:// Mostra a SnackBar\nsetSbStatus({open:true,severity:'success',message:'Dados salvos com sucesso!'});_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](0);// Mostra a SnackBar\nsetSbStatus({open:true,severity:'error',message:'ERRO: '+_context2.t0.message});case 15:// Restaura o estado inicial do botão de envio\nsetSendBtnStatus({disabled:false,label:'Enviar'});case 16:case\"end\":return _context2.stop();}}},_callee2,null,[[0,12]]);}));return _saveData.apply(this,arguments);}function handleSubmit(event){event.preventDefault();// Evita que a página seja recarregada\n// Só envia para o banco de dados se o formulário for válido\nif(validate(karango))saveData();}function handleSbClose(){setSbStatus(_objectSpread(_objectSpread({},sbStatus),{},{open:false}));// Retorna para a página de listagem em caso de sucesso\nif(sbStatus.severity==='success')history.push('/list');}function handleDialogClose(result){setDialogOpen(false);// Se o usuário concordou em voltar \nif(result)history.push('/list');}function handleGoBack(){// Se o formulário tiver sido modificado, exibimos o diálogo de confirmação\nif(isModified)setDialogOpen(true);// Senão, podemos voltar diretamente para a listagem\nelse history.push('/list');}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ConfirmDialog,{isOpen:dialogOpen,onClose:handleDialogClose,children:\"H\\xE1 dados n\\xE3o salvos. Deseja realmente voltar?\"}),/*#__PURE__*/_jsx(Snackbar,{open:sbStatus.open,autoHideDuration:6000,onClose:handleSbClose,children:/*#__PURE__*/_jsx(MuiAlert,{elevation:6,variant:\"filled\",onClose:handleSbClose,severity:sbStatus.severity,children:sbStatus.message})}),/*#__PURE__*/_jsx(\"h1\",{children:title}),/*#__PURE__*/_jsxs(\"form\",{className:classes.form,onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(TextField,{id:\"marca\",label:\"Marca\",variant:\"filled\",value:karango.marca,onChange:handleInputChange,required:true/* not null, precisa ser preenchido */,placeholder:\"Informe a marca do ve\\xEDculo\",fullWidth:true,error:error.marca!=='',helperText:error.marca}),/*#__PURE__*/_jsx(TextField,{id:\"modelo\",label:\"Modelo\",variant:\"filled\",value:karango.modelo,onChange:handleInputChange,required:true/* not null, precisa ser preenchido */,placeholder:\"Informe o modelo do ve\\xEDculo\",fullWidth:true,error:error.modelo!=='',helperText:error.modelo}),/*#__PURE__*/_jsx(TextField,{id:\"cor\",label:\"Cor\",variant:\"filled\",value:karango.cor,onChange:function onChange(event){return handleInputChange(event,'cor');},required:true/* not null, precisa ser preenchido */,placeholder:\"Informe a cor do ve\\xEDculo\",select:true,fullWidth:true,error:error.cor!=='',helperText:error.cor,children:colors.map(function(color){return/*#__PURE__*/_jsx(MenuItem,{value:color,children:color},color);})}),/*#__PURE__*/_jsx(TextField,{id:\"ano_fabricacao\",label:\"Ano de fabrica\\xE7\\xE3o\",variant:\"filled\",value:karango.ano_fabricacao,onChange:function onChange(event){return handleInputChange(event,'ano_fabricacao');},required:true/* not null, precisa ser preenchido */,placeholder:\"Informe o ano de fabrica\\xE7\\xE3o do ve\\xEDculo\",select:true,fullWidth:true,children:years.map(function(year){return/*#__PURE__*/_jsx(MenuItem,{value:year,children:year},year);})}),/*#__PURE__*/_jsx(FormControl,{fullWidth:true,children:/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{id:\"importado\",checked:importadoChecked,onChange:handleInputChange}),label:\"Importado?\"})}),/*#__PURE__*/_jsx(InputMask,{id:\"placa\",mask:placaMask,formatChars:formatChars,value:karango.placa,onChange:function onChange(event){return handleInputChange(event,'placa');},children:function children(){return/*#__PURE__*/_jsx(TextField,{label:\"Placa\",variant:\"filled\",required:true/* not null, precisa ser preenchido */,placeholder:\"Informe a placa do ve\\xEDculo\",fullWidth:true,error:error.placa!=='',helperText:error.placa});}}),/*#__PURE__*/_jsx(TextField,{id:\"preco\",label:\"Pre\\xE7o\",variant:\"filled\",value:karango.preco,onChange:handleInputChange,required:true/* not null, precisa ser preenchido */,placeholder:\"Informe o valor do ve\\xEDculo\",fullWidth:true,type:\"number\",onFocus:function onFocus(event){return event.target.select();}// Seleciona o conteúdo ao focar\n,InputProps:{startAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"start\",children:\"R$\"})},error:error.preco!=='',helperText:error.preco}),/*#__PURE__*/_jsxs(Toolbar,{className:classes.toolbar,children:[/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",color:\"secondary\",disabled:sendBtnStatus.disabled,children:sendBtnStatus.label}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:handleGoBack,children:\"Voltar\"})]})]})]});}","map":{"version":3,"sources":["/workspace/Karangos/karangos/src/routed/KarangosForm.js"],"names":["useState","useEffect","TextField","MenuItem","FormControl","FormControlLabel","Checkbox","InputMask","makeStyles","InputAdornment","Toolbar","Button","axios","useHistory","useParams","Snackbar","MuiAlert","React","ConfirmDialog","useStyles","theme","form","display","justifyContent","flexWrap","maxWidth","margin","minWidth","toolbar","width","marginTop","KarangosForm","classes","colors","years","i","Date","getFullYear","push","formatChars","placaMask","id","marca","modelo","cor","ano_fabricacao","importado","placa","preco","karango","setKarango","currentId","setCurrentId","importadoChecked","setImportadoChecked","disabled","label","sendBtnStatus","setSendBtnStatus","open","severity","message","sbStatus","setSbStatus","error","setError","isModified","setIsModified","dialogOpen","setDialogOpen","title","setTitle","history","params","getData","get","response","data","handleInputChange","event","property","karangoTemp","target","newState","value","toUpperCase","validate","isValid","errorTemp","trim","includes","isNaN","Number","saveData","put","post","handleSubmit","preventDefault","handleSbClose","handleDialogClose","result","handleGoBack","map","color","year","select","startAdornment"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'\nimport TextField from '@material-ui/core/TextField'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport FormControl from '@material-ui/core/FormControl'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport Checkbox from '@material-ui/core/Checkbox'\nimport InputMask from 'react-input-mask'\nimport { makeStyles } from '@material-ui/core/styles'\nimport InputAdornment from '@material-ui/core/InputAdornment'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Button from '@material-ui/core/Button'\nimport axios from 'axios'\nimport { useHistory, useParams } from 'react-router-dom'\nimport Snackbar from '@material-ui/core/Snackbar'\nimport MuiAlert from '@material-ui/lab/Alert'\nimport React from 'react'\nimport ConfirmDialog from '../ui/ConfirmDialog'\n\nconst useStyles = makeStyles(theme => ({\n  form: {\n    display: 'flex',\n    justifyContent: 'space-around',\n    flexWrap: 'wrap',\n    maxWidth: '80%',\n    margin: '0 auto',\n    '& .MuiFormControl-root': {\n      minWidth: '200px',\n      maxWidth: '500px',\n      margin: '0 24px 24px 0'\n    }\n  },\n  toolbar: {\n    display: 'flex',\n    width: '100%',\n    justifyContent: 'space-around',\n    marginTop: '36px'\n  }\n}))\n\nexport default function KarangosForm() {\n  const classes = useStyles()\n\n  const colors = [\n    'Amarelo',\n    'Azul',\n    'Bege',\n    'Branco',\n    'Cinza',\n    'Dourado',\n    'Laranja',\n    'Marrom',\n    'Prata',\n    'Preto',\n    'Rosa',\n    'Roxo',\n    'Verde',\n    'Vermelho',\n    'Vinho'\n  ]\n\n  const years = []\n  for(let i = (new Date()).getFullYear(); i >= 1900; i--) years.push(i)\n\n  // Classes de caracters para a máscara da placa\n  // 1) Três primeiras posições, somente letras (maiúsculas ou minúsculas) ~> [A-Za-z]\n  // 2) Quinta, sétima e oitava posições, somente dígitos ~> [0-9]\n  // 3) Sexta posição: dígitos ou letras (maiúsculas ou minúsculas) de A a J ~> [0-9A-Ja-j]\n  const formatChars = {\n    'A': '[A-Za-z]',\n    '0': '[0-9]',\n    '#': '[0-9A-Ja-j]'\n  }\n\n  // Máscara de entrada para a placa\n  const placaMask = 'AAA-0#00'\n\n  // Máscara para CPF: '000.000.000-00'\n  // Máscara para CNPJ: '00.000.000/0000-00'\n\n  const [karango, setKarango] = useState({\n    id: null,\n    marca: '',\n    modelo: '',\n    cor: '',\n    ano_fabricacao: (new Date()).getFullYear(),    // Ano corrente\n    importado: '0',\n    placa: '',\n    preco: 0\n  })\n  const [currentId, setCurrentId] = useState()\n\n  const [importadoChecked, setImportadoChecked] = useState(false)\n\n  const [sendBtnStatus, setSendBtnStatus] = useState({\n    disabled: false,\n    label: 'Enviar'\n  })\n\n  const [sbStatus, setSbStatus] = useState({\n    open: false,\n    severity: 'success',\n    message: '' \n  })\n\n  const [error, setError] = useState({\n    marca: '',\n    modelo: '',\n    cor: '',\n    placa: '',\n    preco: ''\n  })\n\n  const [isModified, setIsModified] = useState(false)\n\n  const [dialogOpen, setDialogOpen] = useState(false) // O diálogo de confirmação está aberto?\n\n  const [title, setTitle] = useState('Cadastrar novo karango')\n\n  const history = useHistory()\n  const params = useParams()\n\n  // useEffect() para quando o formulário for carregado (só na inicialização)\n  useEffect(() => {\n    // Verificamos se a rota atual contém o parâmetro id\n    // Em caso positivo, buscamos os dados no back-end e carregamos o formulário para edição\n    if(params.id) {\n      setTitle('Editar karango')\n      getData(params.id)\n    }\n  }, [])\n\n  async function getData(id) {\n    try {\n      let response = await axios.get(`https://api.faustocintra.com.br/karangos/${id}`)\n      setKarango(response.data)\n    }\n    catch(error) {\n      setSbStatus({\n        open: true,\n        severity: 'error',\n        message: 'Não foi possível carregar os dados para edição.'\n      })\n    }\n  }\n\n  function handleInputChange(event, property) {\n\n    const karangoTemp = {...karango}\n\n    setCurrentId(event.target.id)\n    if(event.target.id) property = event.target.id\n\n    if(property === 'importado') {\n      const newState = ! importadoChecked // Inverte o valor\n      if(newState) karangoTemp.importado = '1'\n      else karangoTemp.importado = '0'\n      setImportadoChecked(newState) \n    }\n    else if(property === 'placa') {\n      karangoTemp.placa = event.target.value.toUpperCase()\n    }\n    else {\n      // Quando o nome de uma propriedade de objeto aparece entre [],\n      // significa que o nome da propriedade será determinado pela\n      // variável ou expressão contida dentro dos colchetes\n      karangoTemp[property] = event.target.value\n    }\n    setKarango(karangoTemp)\n    setIsModified(true)   // O formulário foi modificado\n    validate(karangoTemp)  // Dispara a validação\n  }\n\n  function validate(data) {\n    let isValid = true\n\n    const errorTemp = {\n      marca: '',\n      modelo: '',\n      cor: '',\n      placa: '',\n      preco: ''\n    }\n\n    // trim(): retira espaços em branco do início e do final de uma string\n    if(data.marca.trim() === '') {\n      errorTemp.marca = 'A marca deve ser preenchida'\n      isValid = false\n    }     \n\n    if(data.modelo.trim() === '') {\n      errorTemp.modelo = 'O modelo deve ser preenchido'\n      isValid = false\n    }\n\n    if(data.cor.trim() === '') {\n      errorTemp.cor = 'A cor deve ser informada'\n      isValid = false\n    }\n\n    // A placa não pode ser string vazia nem conter sublinhado\n    if(data.placa.trim() === '' || data.placa.includes('_')) {\n      errorTemp.placa = 'A placa deve ser preenchida corretamente'\n      isValid = false\n    }\n\n    // O preço deve ser numérico e maior que zero\n    if(isNaN(data.preco) || Number(data.preco) <= 0) {\n      errorTemp.preco = 'O preço deve ser informado e maior que zero'\n      isValid = false\n    }\n\n    setError(errorTemp)\n    return isValid\n  }\n\n  async function saveData() {\n    try {\n      // Desabilita o botão de enviar para evitar envios duplicados\n      setSendBtnStatus({disabled: true, label: 'Enviando...'})\n      \n      // Se estivermos editando, precisamos enviar os dados com o verbo HTTP PUT\n      if(params.id) await axios.put(`https://api.faustocintra.com.br/karangos/${params.id}`, karango)\n      // Senão, estaremos criando um novo registro, e o verbo HTTP a ser usado é o POST\n      else await axios.post('https://api.faustocintra.com.br/karangos', karango)\n      \n      // Mostra a SnackBar\n      setSbStatus({open: true, severity: 'success', message: 'Dados salvos com sucesso!'})\n      \n    }\n    catch(error) {\n      // Mostra a SnackBar\n      setSbStatus({open: true, severity: 'error', message: 'ERRO: ' + error.message})\n    }\n    // Restaura o estado inicial do botão de envio\n    setSendBtnStatus({disabled: false, label: 'Enviar'})\n  }\n\n  function handleSubmit(event) {\n\n    event.preventDefault()    // Evita que a página seja recarregada\n\n    // Só envia para o banco de dados se o formulário for válido\n    if(validate(karango)) saveData()\n\n  }\n\n  function handleSbClose() {\n    setSbStatus({...sbStatus, open: false})\n\n    // Retorna para a página de listagem em caso de sucesso\n    if(sbStatus.severity === 'success') history.push('/list')\n  }\n\n  function handleDialogClose(result) {\n    setDialogOpen(false)\n\n    // Se o usuário concordou em voltar \n    if(result) history.push('/list')\n  }\n\n  function handleGoBack() {\n    // Se o formulário tiver sido modificado, exibimos o diálogo de confirmação\n    if(isModified) setDialogOpen(true)\n    // Senão, podemos voltar diretamente para a listagem\n    else history.push('/list')\n  }\n\n  return (\n    <>\n\n      <ConfirmDialog isOpen={dialogOpen} onClose={handleDialogClose}>\n        Há dados não salvos. Deseja realmente voltar?\n      </ConfirmDialog>\n\n      <Snackbar open={sbStatus.open} autoHideDuration={6000} onClose={handleSbClose}>\n        <MuiAlert elevation={6} variant=\"filled\" onClose={handleSbClose} severity={sbStatus.severity}>\n          {sbStatus.message}\n        </MuiAlert>\n      </Snackbar>\n\n      <h1>{title}</h1>\n      <form className={classes.form} onSubmit={handleSubmit}>\n        \n        <TextField \n          id=\"marca\" \n          label=\"Marca\" \n          variant=\"filled\"\n          value={karango.marca}\n          onChange={handleInputChange}\n          required  /* not null, precisa ser preenchido */\n          placeholder=\"Informe a marca do veículo\"\n          fullWidth\n          error={error.marca !== ''}\n          helperText={error.marca}\n        />\n\n        <TextField \n          id=\"modelo\" \n          label=\"Modelo\" \n          variant=\"filled\"\n          value={karango.modelo}\n          onChange={handleInputChange}\n          required  /* not null, precisa ser preenchido */\n          placeholder=\"Informe o modelo do veículo\"\n          fullWidth\n          error={error.modelo !== ''}\n          helperText={error.modelo}\n        />\n\n        <TextField \n          id=\"cor\" \n          label=\"Cor\" \n          variant=\"filled\"\n          value={karango.cor}\n          onChange={event => handleInputChange(event, 'cor')}\n          required  /* not null, precisa ser preenchido */\n          placeholder=\"Informe a cor do veículo\"\n          select\n          fullWidth\n          error={error.cor !== ''}\n          helperText={error.cor}\n        >\n          { colors.map(color => <MenuItem value={color} key={color}>{color}</MenuItem>)}\n        </TextField>\n\n        <TextField \n          id=\"ano_fabricacao\" \n          label=\"Ano de fabricação\" \n          variant=\"filled\"\n          value={karango.ano_fabricacao}\n          onChange={event => handleInputChange(event, 'ano_fabricacao')}\n          required  /* not null, precisa ser preenchido */\n          placeholder=\"Informe o ano de fabricação do veículo\"\n          select\n          fullWidth\n        >\n          { years.map(year => <MenuItem value={year} key={year}>{year}</MenuItem>)}\n        </TextField>\n\n        <FormControl fullWidth>\n          <FormControlLabel control={\n            <Checkbox\n              id=\"importado\"\n              checked={importadoChecked}\n              onChange={handleInputChange}\n            />\n          }\n          label=\"Importado?\"\n        />\n        </FormControl>\n\n        <InputMask\n          id=\"placa\" \n          mask={placaMask}\n          formatChars={formatChars}\n          value={karango.placa}\n          onChange={(event) => handleInputChange(event, 'placa')}\n        >\n          {() => <TextField \n            label=\"Placa\" \n            variant=\"filled\"\n            required  /* not null, precisa ser preenchido */\n            placeholder=\"Informe a placa do veículo\"\n            fullWidth\n            error={error.placa !== ''}\n            helperText={error.placa}\n          />}\n        </InputMask>\n\n        <TextField \n          id=\"preco\" \n          label=\"Preço\" \n          variant=\"filled\"\n          value={karango.preco}\n          onChange={handleInputChange}\n          required  /* not null, precisa ser preenchido */\n          placeholder=\"Informe o valor do veículo\"\n          fullWidth\n          type=\"number\"\n          onFocus={event => event.target.select()}  // Seleciona o conteúdo ao focar\n          InputProps={{\n            startAdornment: <InputAdornment position=\"start\">R$</InputAdornment>,\n          }}\n          error={error.preco !== ''}\n          helperText={error.preco}\n        />\n\n        <Toolbar className={classes.toolbar}>\n          <Button type=\"submit\" variant=\"contained\" color=\"secondary\" disabled={sendBtnStatus.disabled}>\n            {sendBtnStatus.label}\n          </Button>\n          <Button variant=\"contained\" onClick={handleGoBack}>Voltar</Button>\n        </Toolbar>\n\n        {/* <div>\n          {JSON.stringify(karango)}\n          <br />\n          currentId: {JSON.stringify(currentId)}\n          <br />\n          isModified: {JSON.stringify(isModified)}\n        </div> */}\n      </form>\n    </>\n  )\n}"]},"metadata":{},"sourceType":"module"}